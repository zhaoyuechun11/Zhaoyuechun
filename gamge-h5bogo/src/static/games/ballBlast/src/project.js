window.__require=function e(t,c,i){function n(a,r){if(!c[a]){if(!t[a]){var s=a.split("/");if(s=s[s.length-1],!t[s]){var l="function"==typeof __require&&__require;if(!r&&l)return l(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+a+"'")}}var h=c[a]={exports:{}};t[a][0].call(h.exports,function(e){return n(t[a][1][e]||e)},h,h.exports,e,t,c,i)}return c[a].exports}for(var o="function"==typeof __require&&__require,a=0;a<i.length;a++)n(i[a]);return n}({contact:[function(e,t,c){"use strict";cc._RF.push(t,"ad24a9MguRIwbzX/3P0O9FS","contact"),cc.Class({extends:cc.Component,properties:{m_type:0,m_scene:cc.Node},onLoad:function(){},onBeginContact:function(e,t,c){var i=c.node;"bullet"==i.group&&(i.stopAllActions(),i.removeFromParent(!0));var n=t.node,o=this.m_scene.getComponent("game");switch(this.m_type){case 1:if("bullet"==i.group){o.addScore(1);var a=n.children[0].children[1].getComponent(cc.Label).string;if((a=Number(a)-1)<=0)o.removeMonster(n,!0);else n.children[0].children[1].getComponent(cc.Label).string=a,(r=n.getComponent(cc.RigidBody).linearVelocity).x<0&&(n.getComponent(cc.RigidBody).linearVelocity=cc.v2(r.x,r.y-200)),a%2==0&&o.splitMonster(n)}else if("car"==i.group)o.resurrection(i);else if("wall"==i.group){var r;(r=n.getComponent(cc.RigidBody).linearVelocity).y>-700&&"bottom"==i.name&&(n.getComponent(cc.RigidBody).linearVelocity=cc.v2(r.x,800)),(r=n.getComponent(cc.RigidBody).linearVelocity).x>100?n.getComponent(cc.RigidBody).linearVelocity=cc.v2(100,r.y):r.x<-100&&(n.getComponent(cc.RigidBody).linearVelocity=cc.v2(-100,r.y))}break;case 20:"car"==i.group&&o.resurrection(i);break;case 31:o._bulletType=1,o._lastBulletType=1,o._hasCoin=!1,n.removeFromParent(!0);break;case 32:o._bulletType=1,o._lastBulletType=2,o._hasCoin=!1,n.removeFromParent(!0);break;case 33:o._bulletType=3,o._lastBulletType=3,o._hasCoin=!1,n.removeFromParent(!0);break;case 34:o._bulletType=4,o._lastBulletType=4,o._hasCoin=!1,n.removeFromParent(!0)}}}),cc._RF.pop()},{}],game:[function(e,t,c){"use strict";cc._RF.push(t,"4ca0dK4A+9C2ZELjwOEO6E/","game"),cc.Class({extends:cc.Component,properties:{m_role:cc.Node,m_center:cc.Node,m_time:cc.Label,m_myScore:cc.Label,m_bullet1:cc.Node,m_bullet3:cc.Node,ready_go:{default:null,url:cc.AudioClip}},onLoad:function(){cc.director.getPhysicsManager().enabled=!0,this._bullet1_angle=15,this._lastBulletType=1,this._monsters=[],window.parent.postMessage({cmd:"GameLoadReady"},"*"),window.parent.postMessage({cmd:"GamePlayReady"},"*");var e=this;window.addEventListener("message",function(t){switch(t.data.cmd){case"Broadcast":var c=JSON.parse(t.data.data.data);c.userId!=e.m_myId&&"showClown"==c.type&&(e.showClown(),e._showing_clown=!0);break;case"UpdateData":e._myId!=t.data.data.userId&&e.updateOtherScore(t.data.data.userScore);break;case"GameResult":console.log("=========recive: GameResult");break;case"GameBegin":e.onGameBegin(t.data)}}),cc.director.getScene().children[0].on("touchmove",this.roleMove_ing,this),cc.director.getScheduler().schedule(this.shoot,this,.2,cc.macro.REPEAT_FOREVER,0,!1),cc.director.getScheduler().schedule(this.addCoin,this,1,0,0,!1),cc.director.getScheduler().schedule(this.addMonster,this,.5,0,0,!1),cc.director.getScheduler().schedule(this.showTime,this,1,cc.macro.REPEAT_FOREVER,0,!1),cc.director.getScheduler().schedule(this.sendScore,this,1,cc.macro.REPEAT_FOREVER,0,!1),cc.director.getScheduler().schedule(this.showUFO,this,25,cc.macro.REPEAT_FOREVER,0,!1)},start:function(){this._bulletType=1,this.m_role.x=0},roleMove_ing:function(e){var t=this.m_role.convertToWorldSpaceAR(cc.v2(0,0)).x,c=e.touch.getDelta().x,i=this.m_role.width/2-10;c<0&&t<0+i||c>0&&t>cc.winSize.width-i||(this.m_role.x+=c)},readyGo:function(){var e=this.node.getChildByName("UI").getChildByName("ready"),t=this.node.getChildByName("UI").getChildByName("go");e.active=!0,e.scale=0,e.runAction(cc.sequence(cc.scaleTo(.3,1).easing(cc.easeIn(2)),cc.delayTime(.3),cc.scaleTo(.3,0).easing(cc.easeOut(2)),cc.callFunc(function(){e.active=!1,t.active=!0,t.scale=0,t.runAction(cc.sequence(cc.delayTime(.3),cc.scaleTo(.3,1).easing(cc.easeIn(2)),cc.delayTime(.8),cc.scaleTo(.3,0).easing(cc.easeOut(2)),cc.callFunc(function(){t.active=!1})))}))),cc.audioEngine.playEffect(this.ready_go,!1)},onGameBegin:function(e){var t=this.node.getChildByName("UI").getChildByName("mask1");cc.loader.load(e.data[0].userHead,function(e,c){t.getChildByName("icon").getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(c)}),e.data[0].userHeadFrame&&cc.loader.load(e.data[0].userHeadFrame,function(e,c){t.getChildByName("frame").getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(c)}),this._myId=e.data[0].userId;var c=this.node.getChildByName("mask1");cc.loader.load(e.data[1].userHead,function(e,t){c.getChildByName("icon").getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t)}),e.data[1].userHeadFrame&&cc.loader.load(e.data[1].userHeadFrame,function(e,t){c.getChildByName("frame").getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t)}),this._otherId=e.data[1].userId,this._isRobot=!1,1==e.data[1].isRobot&&(this._isRobot=!0),this.readyGo()},shoot:function(){var e=[];switch(this._bulletType){case 1:e.push(cc.instantiate(this.m_bullet1)),e[0].children[0].getComponents(cc.Animation)[0].play();break;case 3:e.push(cc.instantiate(this.m_bullet3)),e.push(cc.instantiate(this.m_bullet3)),e.push(cc.instantiate(this.m_bullet3)),e[0].rotation=-this._bullet1_angle,e[2].rotation=this._bullet1_angle}for(var t=0;t<e.length;t++){e[t]._type=this._bulletType,e[t].parent=this.node.getChildByName("fight").getChildByName("panel");var c=this.m_role.getChildByName("output").convertToWorldSpaceAR(cc.v2(0,0));e[t].position=e[t].parent.convertToNodeSpaceAR(c);var i=cc.v2(0,cc.winSize.height);if(e.length>1){var n=cc.winSize.height*Math.cos(this._bullet1_angle*Math.PI/180);1==t&&cc.winSize.height,i=cc.v2((t-1)*Math.sin(this._bullet1_angle*Math.PI/180)*cc.winSize.height,n)}e[t].runAction(cc.sequence(cc.moveBy(1,i),cc.callFunc(function(e){e.removeFromParent(!0)})))}},addCoin:function(){if(!(Number(this.m_time.string)<=0)){var e=this,t=cc.sequence(cc.delayTime(5*Math.random()+10),cc.callFunc(function(){e.addCoin()}));if(this._hasCoin)this.node.runAction(t);else{var c=this.node.getChildByName("fight"),i=Math.floor(4*Math.random()+1);if(i!=this._lastBulletType&&i!=this._bulletType){var n=c.getChildByName("icon_props_0"+i.toString());if(null!=n){console.log(i+"**********************************"+this._lastBulletType),this._hasCoin=!0;var o=cc.instantiate(n);o.parent=c;var a=Math.random()>.5?1:-1;o.y=this.m_center.y,o.x=a*(cc.winSize.width/2+o.width);e=this;o.runAction(cc.sequence(cc.moveBy(3,cc.v2(-a*(cc.winSize.width+2*o.width),0)),cc.callFunc(function(t){t.removeFromParent(!0),e._hasCoin=!1}))),this.node.runAction(t)}else this.node.runAction(t)}else this.node.runAction(t)}}},addMonster:function(){if(!(Number(this.m_time.string)<=0)){for(var e=this,t=cc.sequence(cc.delayTime(2*Math.random()+3),cc.callFunc(function(){e.addMonster()})),c=0,i=0;i<this._monsters.length;i++)c+=this._monsters[i].val;var n=Number(this.m_time.string)%20;if(c<100*n||this._monsters.length<n/5*2){var o=Math.floor(3*Math.random())%3;this.createMonster(o,Math.pow(2,Math.floor(5*Math.random())+1))}this.node.runAction(t)}},createMonster:function(e,t){var c=this.node.getChildByName("fight"),i=Math.floor(10*Math.random())%10,n=cc.instantiate(c.getChildByName("monster_0"+i.toString()));n.parent=c.getChildByName("panel");var o=Math.random()>.5?1:-1;n._id=this._monsters.length,n._type=i,n.y=this.m_center.y,n.x=o*(cc.winSize.width/2+n.width),n.scale=1+.2*(e-1),n.children[0].children[1].getComponent(cc.Label).string=t.toString(),n.children[0].getComponent("idle").init(),n.runAction(cc.sequence(cc.moveBy(2,cc.v2(-o*n.width*2,0)),cc.callFunc(function(e){e.getComponent(cc.RigidBody).linearVelocity=cc.v2(100*-o,0),e.getComponent(cc.RigidBody).type=cc.RigidBodyType.Dynamic}))),this._monsters.push({id:n._id,type:n._type,scale:n.scale,val:t})},removeMonster:function(e,t){for(var c=0;c<this._monsters.length;c++)if(this._monsters[c].id==e._id){this._monsters.splice(c);break}var i=this.node.getChildByName("fight"),n=e.position,o=e.scale,a=i.getChildByName("panel");if(e.removeFromParent(!0),t){var r=cc.instantiate(i.getChildByName("effect_bons"));r.position=n,r.scale=o,r.parent=a,r.getComponent(cc.Animation).play(),r.getComponent(cc.Animation).on("finished",function(){r.removeFromParent(!0)})}},splitMonster:function(e){var t=Number(e.children[0].children[1].getComponent(cc.Label).string);if(!(.8==e.scale||0==t||t%2==1||this.m_center.y-e.width>e.y||Math.random()>.5)){for(var c=this.node.getChildByName("fight"),i=0;i<2;i++){var n=cc.instantiate(c.getChildByName("monster_0"+e._type.toString()));n.parent=c.getChildByName("panel"),n._id=this._monsters.length,n._type=e._type,n.position=e.position,n.scale=e.scale-.2,n.children[0].children[1].getComponent(cc.Label).string=(t/2).toString(),n.getComponent(cc.RigidBody).linearVelocity=cc.v2(300*(i>0?1:-1),0),n.getComponent(cc.RigidBody).type=cc.RigidBodyType.Dynamic,this._monsters.push({id:n._id,type:n._type,scale:n.scale,val:t/2})}this.removeMonster(e,!1)}},clearMonster:function(){for(var e=0,t=0;t<this._monsters.length;t++)e+=this._monsters[t].val;e>0&&this.addScore(e),this._bulletType=1,this._lastBulletType=1,this._monsters=[],this._showing_nuclear=null,this.m_role.getChildByName("pc_01_ske").getComponent(dragonBones.ArmatureDisplay).playAnimation("Animation_pc_attack",0)},nuclearExplosion:function(){this.m_role.getChildByName("pc_01_ske").getComponent(dragonBones.ArmatureDisplay).playAnimation("Animation_pc_run",0);var e=this.node.getChildByName("fight"),t=cc.instantiate(this.node.getChildByName("bullet4"));t.parent=e;var c=this.m_role.getChildByName("output").convertToWorldSpaceAR(cc.v2(0,0));t.position=e.convertToNodeSpaceAR(c);var i=this.m_center.convertToWorldSpaceAR(cc.v2(0,0)),n=e.convertToNodeSpaceAR(i);n.x=t.x;var o=this;t.runAction(cc.sequence(cc.moveTo(2,n).easing(cc.easeOut(1)),cc.scaleTo(.2,0),cc.callFunc(function(e){e.removeFromParent(parent),o.node.getChildByName("fight").getChildByName("panel").removeAllChildren(!0),o.node.getChildByName("fight").getChildByName("explosion").runAction(cc.sequence(cc.fadeTo(.5,180).easing(cc.easeOut(.5)),cc.fadeOut(.3),cc.callFunc(function(e){o.clearMonster()})))})))},showClown:function(){var e=this.node.getChildByName("fight"),t=cc.instantiate(e.getChildByName("props_04_ske"));t.parent=e.getChildByName("panel");var c=Math.random()>.5?1:-1;t.y=this.m_center.y,t.x=c*(cc.winSize.width/2+t.width),t.getComponent(cc.RigidBody).angularVelocity=30*-c,t.getComponent(cc.RigidBody).linearVelocity=cc.v2(100*-c,0);var i=this;t.runAction(cc.sequence(cc.moveBy(2,cc.v2(-c*t.width*2)),cc.callFunc(function(e){e.getComponent(cc.RigidBody).type=cc.RigidBodyType.Dynamic}),cc.delayTime(15),cc.fadeOut(1),cc.callFunc(function(e){e.getComponent(cc.RigidBody).type=cc.RigidBodyType.Kinematic,e.y=i.m_center.y,e.x=1e4,e.opacity=255,i._lastBulletType=1,i._showing_clown=null})))},resurrection:function(e){cc.director.getScheduler().unschedule(this.shoot,this);var t=Number(this.m_myScore.string)-10;t<0&&(t=10),this.m_myScore.string=t;var c=e.position;e.opacity=.1,e.group="ball",e.getComponent(cc.PhysicsBoxCollider).enabled=!1;var i=this;e.runAction(cc.sequence(cc.delayTime(1),cc.callFunc(function(e){e.position=c,e.opacity=255,e.getChildByName("pc_01_ske").color=cc.Color.RED,cc.director.getScheduler().schedule(i.shoot,i,.2,cc.macro.REPEAT_FOREVER,0,!1)}),cc.fadeOut(.5).easing(cc.easeOut(.5)),cc.fadeIn(.5).easing(cc.easeIn(.5)),cc.fadeOut(.5).easing(cc.easeOut(.5)),cc.fadeIn(.5).easing(cc.easeIn(.5)),cc.fadeOut(.5).easing(cc.easeOut(.5)),cc.fadeIn(.5).easing(cc.easeIn(.5)),cc.callFunc(function(t){t.getChildByName("pc_01_ske").color=cc.Color.WHITE,t.group="car",e.getComponent(cc.PhysicsBoxCollider).enabled=!0})))},addScore:function(e){this.m_myScore.string=Number(this.m_myScore.string)+e,this.showScore()},updateOtherScore:function(e){this.node.getChildByName("UI").getChildByName("label_02").getComponent(cc.Label).string=e,this.showScore()},showScore:function(){var e=this.node.getChildByName("UI"),t=Number(this.m_myScore.string),c=Number(e.getChildByName("label_02").getComponent(cc.Label).string),i=e.getChildByName("ui_health_sit").width-14;e.getChildByName("ui_health_pl").width=i*t/(t+c),e.getChildByName("ui_health_ol").x=e.getChildByName("ui_health_pl").x+e.getChildByName("ui_health_pl").width},sendScore:function(){if(window.parent.postMessage({cmd:"SendGameData",data:Number(this.m_myScore.string),uid:this._myId},"*"),this._isRobot){var e=Number(this.node.getChildByName("UI").getChildByName("label_02").getComponent(cc.Label).string);e+=10*Math.random()+Math.random()>.9?100*Math.random()+50:0,this.updateOtherScore(e),Number(this.m_time.string)%(5*Math.random()+5)==0&&(this.showClown(),this._showing_clown=!0)}},sendClown:function(){window.parent.postMessage({cmd:"BroadCastData",uid:this.m_myId,data:{type:"showClown",userId:this._myId}},"*")},showTime:function(){var e=Number(this.m_time.string);e>0?this.m_time.string=(--e).toString():(cc.director.getScheduler().unschedule(this.shoot,this),cc.director.getScheduler().unschedule(this.showTime,this),cc.director.getScheduler().unschedule(this.sendScore,this),cc.director.getScheduler().unschedule(this.showUFO,this),cc.director.getScheduler().unscheduleUpdate(),this._monsters=[],this.node.getChildByName("fight").getChildByName("panel").removeAllChildren(!0),this.m_role.active=!1)},showUFO:function(){for(var e=this.node.getChildByName("bg"),t=e.getChildByName("sc_pl_01"),c=[],i=1;i<=7;i++)c.push(e.getChildByName("pos"+i.toString()).position);t.opacity=0,t.position=c[0],t.runAction(cc.sequence(cc.spawn(cc.fadeIn(.5).easing(cc.easeOut(.5)),cc.moveTo(.5,c[1])),cc.cardinalSplineTo(3,[c[2],c[3],c[4],c[5]],.2),cc.spawn(cc.fadeOut(.5).easing(cc.easeIn(.5)),cc.moveTo(.5,c[6])),cc.callFunc(function(e){e.x=1e4})))},update:function(e){2==this._lastBulletType&&null==this._showing_clown?this.sendClown():4==this._lastBulletType&&null==this._showing_nuclear&&(this.nuclearExplosion(),this._showing_nuclear=!0)}}),cc._RF.pop()},{}],idle:[function(e,t,c){"use strict";cc._RF.push(t,"757adSl2VZOa5eo+eaIKPag","idle"),cc.Class({extends:cc.Component,properties:{},init:function(){this.randomRotate(),this.heartbeat()},randomRotate:function(){var e=360*(Math.random()>.5?1:-1),t=this,c=cc.sequence(cc.rotateBy(5,e),cc.callFunc(function(){t.randomRotate()}));c.setTag(10001);var i=this.node.getActionByTag(10001);i&&this.node.stopAction(i),this.node.children[0].stopAllActions(),this.node.children[1].stopAllActions(),this.node.runAction(c),this.node.children[0].runAction(cc.rotateBy(5,-e)),this.node.children[1].runAction(cc.rotateBy(5,-e))},heartbeat:function(){this.node.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(.8,.33),cc.scaleTo(.8,.43))))}}),cc._RF.pop()},{}]},{},["contact","game","idle"]);