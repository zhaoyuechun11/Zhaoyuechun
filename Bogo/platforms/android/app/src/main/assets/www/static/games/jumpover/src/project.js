window.__require=function t(e,o,i){function s(a,n){if(!o[a]){if(!e[a]){var l=a.split("/");if(l=l[l.length-1],!e[l]){var r="function"==typeof __require&&__require;if(!n&&r)return r(l,!0);if(c)return c(l,!0);throw new Error("Cannot find module '"+a+"'")}}var d=o[a]={exports:{}};e[a][0].call(d.exports,function(t){return s(e[a][1][t]||t)},d,d.exports,t,e,o,i)}return o[a].exports}for(var c="function"==typeof __require&&__require,a=0;a<i.length;a++)s(i[a]);return s}({block:[function(t,e,o){"use strict";cc._RF.push(e,"98313d7bZFJqKdxyYnvxjBm","block"),cc.Class({extends:cc.Component,properties:{},start:function(){this.mid=this.node.getChildByName("mid"),this.up=this.node.getChildByName("up"),this.down=this.node.getChildByName("down"),this.left=this.node.getChildByName("left"),this.right=this.node.getChildByName("right")},getMidPos:function(){return this.mid.convertToWorldSpaceAR(cc.p(0,0))},is_jump_on_block:function(t,e){var o=this.mid.convertToWorldSpaceAR(cc.p(0,0));console.log("--\x3edst"+t);var i=t.sub(o),s=i.mag(),c=o;if(console.log("--\x3emid"+o,this.mid.getPosition()),1===e){var a=this.up.convertToWorldSpaceAR(cc.p(0,0));s>(r=(i=t.sub(a)).mag())&&(s=r,c=a);var n=this.down.convertToWorldSpaceAR(cc.p(0,0));s>(r=(i=t.sub(n)).mag())&&(s=r,c=n)}else{var l=this.left.convertToWorldSpaceAR(cc.p(0,0));s>(r=(i=t.sub(l)).mag())&&(s=r,c=l);var r,d=this.right.convertToWorldSpaceAR(cc.p(0,0));s>(r=(i=t.sub(d)).mag())&&(s=r,c=d)}return i=t.sub(c),console.log("--\x3edir"+i.mag()),i.mag()<100&&(t.x=c.x,t.y=c.y,!0)},is_jump_on_origin_block:function(t,e){var o=this.mid.convertToWorldSpaceAR(cc.p(0,0));return t.sub(o).mag()<70}}),cc._RF.pop()},{}],game_scene:[function(t,e,o){"use strict";cc._RF.push(e,"0fd31d27O1JdLPDqO4p8XV+","game_scene"),cc.Class({extends:cc.Component,properties:{player:{type:cc.Node,default:null},player2:{type:cc.Node,default:null},block_prefab:{default:[],type:cc.Prefab},block_root:{type:cc.Node,default:null},map_root:{type:cc.Node,default:null},win:{type:cc.Node,default:null},lose:{type:cc.Node,default:null},scoreDisplay:{type:cc.Label,default:null},left_blood:{type:cc.Node,default:null},rightScoreDisplay:{type:cc.Label,default:null},right_blood:{type:cc.Node,default:null},mid_blood:{type:cc.Node,default:null},timeLabel:{type:cc.Label,default:null},user_head:{type:cc.Node,default:null},user1_head:{type:cc.Node,default:null},frogAudio:{default:null,url:cc.AudioClip},landingAudio:{default:null,url:cc.AudioClip},comboAudio:{default:null,url:cc.AudioClip},fallingWaterAudio:{default:null,url:cc.AudioClip},bgAudio:{default:null,url:cc.AudioClip},name1:{type:cc.Label,default:null},name2:{type:cc.Label,default:null},left_org:cc.p(0,0),y_radio:.5560472,totalTime:90,userId:-1,userId2:-2,directions:[]},onLoad:function(){this.play1Score=0,this.play2Score=0,this.play1step=0,this.play2step=0,window.parent.postMessage({cmd:"GameLoadReady"},"*");var t=this;window.addEventListener("message",function(e){switch(console.log("receive message listener",e.data),e.data.cmd){case"Broadcast":var o=JSON.parse(e.data.data.data);console.log("Broadcast----\x3e"+o.type),"jump"==o.type?t.userId!=o.playid&&t.play2Jump(o.target_pos.x,o.target_pos.y,o.direction,o.playid):t.userId!=o.playid?t.onBroadCast(o.index,o.x_distance,o.direction,o.scale,o.next_pos):t.directions.push(o.direction);break;case"UpdateData":console.log("=========UpdateData: "+e.data.data.userScore+"---"+e.data.data.userId),t.userId!=e.data.data.userId&&t.onUpdateUserScore(e.data.data.userScore);break;case"GameResult":break;case"GameBegin":t.userId=e.data.data[0].userId,t.userId2=e.data.data[1].userId,t.onGameBegin(e.data.data[0],e.data.data[1])}}),cc.audioEngine.playEffect(this.bgAudio,!1)},onGameBegin:function(t,e){var o=this;this.countDown(),cc.loader.load(users[0].userHead,function(t,e){t||(o.user_head.node.active=!0,o.user_head.spriteFrame=new cc.SpriteFrame(e))}),cc.loader.load(users[1].userHead,function(t,e){t||(o.user1_head.node.active=!0,o.user1_head.spriteFrame=new cc.SpriteFrame(e))})},onBroadCast:function(t,e,o,i,s){console.log("\u65b0\u589eblock----\x3e"+o),this.cur_block=this.next_block,this.next_block=cc.instantiate(this.block_prefab[t]),(t=this.next_block.getName().startsWith("box"))&&this.next_block.setScale(cc.v2(i,i));var c=this.play2step+1;this.block_root.addChild(this.next_block,c,"block"+c),this.next_block.zIndex=this.block_zorder,this.block_zorder--,this.next_block.position=s,this.directions.push(o)},start:function(){this.onFirstBlock(),this.onSecBlock()},onFirstBlock:function(){this.cur_block=cc.instantiate(this.block_prefab[4]),this.block_root.addChild(this.cur_block,0,"block0"),this.cur_block.setPosition(this.block_root.convertToNodeSpaceAR(this.left_org));var t=this.cur_block.getChildByName("mid").convertToWorldSpaceAR(cc.p(0,0));this.player.setPosition(this.map_root.convertToNodeSpaceAR(t)),this.player2.setPosition(this.map_root.convertToNodeSpaceAR(t)),this.player_com=this.player.getComponent("player"),this.player2_com=this.player.getComponent("player2"),this.next_block=this.cur_block,this.block_zorder=-1},onSecBlock:function(){this.cur_block=this.next_block,this.next_block=cc.instantiate(this.block_prefab[10]),this.block_root.addChild(this.next_block,1,"block1"),this.next_block.zIndex=this.block_zorder,this.block_zorder--;var t=225*this.y_radio,e=this.cur_block.getPosition();e.x+=225*this.player_com.direction,e.y+=t,this.next_block.setPosition(e),this.player_com.set_next_block(this.next_block.getComponent("block")),this.player_com.set_cur_block(this.cur_block.getComponent("block"))},add_block:function(t,e){if(console.log("add_block---"+this.play1step+"--"+this.play2step+"---\x3e"+this.player_com.direction),this.play1step>this.play2step){this.cur_block=this.next_block;var o=Math.floor(31*Math.random());this.next_block=cc.instantiate(this.block_prefab[o]);cc.instantiate(this.block_prefab[o]);var i=this.next_block.getName().startsWith("box"),s=new Array(1,.7,.55),c=Math.floor(3*Math.random());i&&this.next_block.setScale(cc.v2(s[c],s[c]));var a=this.play1step+1;this.block_root.addChild(this.next_block,a,"block"+a),console.log("xu--\x3eaddChild",this.block_root),this.next_block.zIndex=this.block_zorder,this.block_zorder--;var n=200+200*Math.random(),l=n*this.y_radio,r=this.cur_block.getPosition();r.x+=n*this.player_com.direction,r.y+=l,this.next_block.setPosition(r);var d=this.next_block.position;console.log("local pos "+d),console.log(this.block_root),this.sendBroadCast(o,n,s[c],d),this.player_com.set_next_block(this.next_block.getComponent("block")),this.player_com.set_cur_block(this.cur_block.getComponent("block"))}else{var h="block"+(a=this.play1step+1),p="block"+this.play1step;this.player_com.set_next_block(this.block_root.getChildByName(h).getComponent("block")),this.player_com.set_cur_block(this.block_root.getChildByName(p).getComponent("block"))}this.sendJumpData()},sendJumpData:function(){console.log("sendJumpData---\x3e"),window.parent.postMessage({cmd:"BroadCastData",uid:this.userId2,data:{type:"jump",direction:this.player_com.direction,playid:this.userId,target_pos:this.target_pos}},"*")},sendBroadCast:function(t,e,o,i){console.log("\u53d1\u9001\u589e\u52a0\u7684block--index:--\x3e"+this.player_com.direction),window.parent.postMessage({cmd:"BroadCastData",uid:this.userId2,data:{type:"addblock",index:t,x_distance:e,direction:this.player_com.direction,playid:this.userId,scale:o,target_pos:this.target_pos,next_pos:i}},"*")},sendBlood:function(t,e,o){cc.log("blood"),window.parent.postMessage({cmd:"BroadCastData",uid:this.userId2,data:{type:"blood",left_blood:t,mid:e,right_blood:o}},"*")},sendGameData:function(){window.parent.postMessage({cmd:"SendGameData",data:this.play1Score},"*")},gainScore:function(t){this.play1Score+=t,this.scoreDisplay.string=this.play1Score,this.sendGameData(),this.play1step++,this.play1step>this.play2step?(this.left_blood.width=180+2*this.play1step,this.right_blood.width=180-2*this.play1step,this.mid_blood.x=2*this.play1step):(this.left_blood.width=180-2*this.play2step+2*this.play1step,this.right_blood.width=180+2*this.play2step-2*this.play1step,this.mid_blood.x=2*this.play1step-2*this.play2step)},onUpdateUserScore:function(t){this.play2Score=t,this.rightScoreDisplay.string=this.play2Score,this.play2step++,this.play1step>this.play2step?(this.left_blood.width=180-2*this.play2step,this.right_blood.width=180+2*this.play2step,this.mid_blood.x=2*-this.play2step):(this.left_blood.width=180+2*this.play1step-2*this.play2step,this.right_blood.width=180-2*this.play1step+2*this.play2step,this.mid_blood.x=2*-this.play2step-2*this.play1step)},onDirection:function(){return this.play1step>=this.play2step},getDirection:function(){return this.directions[this.play1step]},play2Jump:function(t,e,o){console.log("play2 --\u8df3---\x3e"+o),this.player_com2=cc.find("Canvas/game/player2/rotate2/anim2"),this.player_com2.getComponent(cc.Animation).play();var i=this.player.getPosition();i.x=t-180,i.y=e;var s=cc.jumpTo(.5,i,200,1),c=cc.callFunc(function(){this.player_com2.runAction(cc.scaleTo(.1,-o,1))}.bind(this)),a=cc.sequence([s,c]);this.player_com2.runAction(a)},move_map:function(t,e,o){this.target_pos=o,console.log("--\x3emove_map:",t,e);var i=cc.moveBy(.5,t,e),s=cc.callFunc(function(){this.add_block(t,e)}.bind(this)),c=cc.sequence([i,s]);this.map_root.runAction(c)},move_start:function(){if(console.log("move_start"),this.play1step>this.play2step){var t=this.cur_block.getChildByName("mid").convertToWorldSpaceAR(cc.p(0,0));this.player.setPosition(this.map_root.convertToNodeSpaceAR(t))}else{var e="block"+this.play1step;t=this.block_root.getChildByName(e).getChildByName("mid").convertToWorldSpaceAR(cc.p(0,0));this.player.setPosition(this.map_root.convertToNodeSpaceAR(t))}},on_checkout_game:function(){this.play1Score>this.play2Score?this.win.active=!0:this.lose.active=!0,cc.audioEngine.stopAll()},on_game_again:function(){cc.director.loadScene("game_scene")},jumpAudio:function(){cc.audioEngine.playEffect(this.frogAudio,!1)},startlandingAudio:function(){cc.audioEngine.playEffect(this.landingAudio,!1)},startfallingWaterAudio:function(){cc.audioEngine.playEffect(this.fallingWaterAudio,!1)},startcomboAudio:function(){cc.audioEngine.playEffect(this.comboAudio,!1)},countDown:function(){this.schedule(function(){this.totalTime--,this.timeLabel.string=this.totalTime,0===this.totalTime&&(this.on_checkout_game(),this.timeLabel.string="00")},1,this.totalTime-1,0)}}),cc._RF.pop()},{}],player2:[function(t,e,o){"use strict";cc._RF.push(e,"132c6WYKHJLtpsdM8CaVBm+","player2");var i=t("game_scene");cc.Class({extends:cc.Component,properties:{init_speed:150,a_power:600,y_radio:.5560472,play_Score:1,jump_complete:!0,game_manager:{type:i,default:null}},onLoad:function(){this.next_block=null,this.direction=1},player_jump:function(){this.anim_node.getComponent(cc.Animation).play();var t=this.x_distance*this.direction,e=this.x_distance*this.y_radio,o=this.node.getPosition();o.x+=t,o.y+=e;var i=this.node.parent.convertToWorldSpaceAR(o),s=-1;this.next_block.is_jump_on_block(i,this.direction)?(o=this.node.parent.convertToNodeSpaceAR(i),s=2):this.cur_block.is_jump_on_origin_block(i,this.direction)?(o=this.node.parent.convertToNodeSpaceAR(i),s=1):s=0;var c=cc.jumpTo(.5,o,200,1);2==s&&(this.direction=Math.random()<.5?-1:1);var a=cc.callFunc(function(){}.bind(this)),n=cc.sequence(c,a);this.node.runAction(n)},set_next_block:function(t){this.next_block=t},set_cur_block:function(t){this.cur_block=t},start:function(){this.rot_node=this.node.getChildByName("rotate2"),this.anim_node=this.rot_node.getChildByName("anim2"),this.power_node=this.rot_node.getChildByName("power2"),this.bg_node=cc.find("Canvas/bg"),this.is_power_mode=!1,this.speed=0,this.x_distance=0,this.stopTime=0},update:function(t){this.is_power_mode&&(this.speed+=this.a_power*t,this.x_distance+=this.speed*t)}}),cc._RF.pop()},{game_scene:"game_scene"}],player:[function(t,e,o){"use strict";cc._RF.push(e,"21c8axcsehOF7uRiV385w6I","player");var i=t("game_scene");cc.Class({extends:cc.Component,properties:{init_speed:150,a_power:600,y_radio:.5560472,play_Score:1,jump_complete:!0,game_manager:{type:i,default:null},scoreDisplay:{type:cc.Label,default:null}},onLoad:function(){this.next_block=null,this.direction=1},player_jump:function(){this.game_manager.jumpAudio();var t=this.x_distance*this.direction,e=this.x_distance*this.y_radio,o=this.node.getPosition();console.log("------\x3etarget_pos"+o),o.x+=t,o.y+=e;var i=this.node.parent.convertToWorldSpaceAR(o),s=-1;this.next_block.is_jump_on_block(i,this.direction)?(o=this.node.parent.convertToNodeSpaceAR(i),s=2):this.cur_block.is_jump_on_origin_block(i,this.direction)?(o=this.node.parent.convertToNodeSpaceAR(i),s=1):s=0;var c=cc.jumpTo(.5,o,200,1);this.game_manager.onDirection()?2==s&&(this.direction=Math.random()<.5?-1:1,console.log("xu--\x3e1",this.direction)):(this.direction=this.game_manager.getDirection(),console.log("xu--\x3e2",this.direction));var a=cc.callFunc(function(){if(0==s)this.game_manager.startfallingWaterAudio(),this.anim3=this.anim_node.getComponent(cc.Animation),this.anim3.play("jump3"),this.anim3.jump3Finished=function(){cc.log("===========================finish"),this.game_manager.move_start(),this.jump_complete=!0}.bind(this);else{if(this.cur_block.is_jump_on_origin_block(i,this.direction))this.game_manager.startlandingAudio();else{var t=this.next_block.getMidPos();i.sub(t).mag()<10?(this.gainScore=Math.pow(2,this.play_Score),this.game_manager.gainScore(Math.pow(2,this.play_Score)),this.game_manager.startcomboAudio(),this.play_Score++):(this.play_Score=1,this.game_manager.gainScore(1),this.game_manager.startlandingAudio(),this.gainScore=1),this.scoreDisplay.string=this.gainScore;var c=cc.fadeIn(.1),a=cc.fadeOut(1),n=cc.sequence(c,a);this.score_node.runAction(n),-1==this.direction?this.game_manager.move_map(530-i.x,-e,o):this.game_manager.move_map(180-i.x,-e,o)}this.jump_complete=!0,this.anim_node.runAction(cc.scaleTo(0,-this.direction,1))}}.bind(this)),n=cc.sequence(c,a);this.node.runAction(n)},set_next_block:function(t){this.next_block=t},set_cur_block:function(t){this.cur_block=t},start:function(){this.rot_node=this.node.getChildByName("rotate"),this.anim_node=this.rot_node.getChildByName("anim"),this.power_node=this.rot_node.getChildByName("power"),this.score_node=this.rot_node.getChildByName("jump_score");var t=this.anim_node.getComponent(cc.Animation);this.bg_node=cc.find("Canvas/bg"),this.is_power_mode=!1,this.speed=0,this.x_distance=0,this.stopTime=0,this.bg_node.on(cc.Node.EventType.TOUCH_START,function(e){this.jump_complete&&(this.is_power_mode=!0,this.x_distance=0,this.speed=this.init_speed,this.power_node.stopAllActions(),this.power_node.runAction(cc.scaleTo(2,1,1)),t.play("jump"))}.bind(this),this),this.bg_node.on(cc.Node.EventType.TOUCH_END,function(e){this.jump_complete&&(this.is_power_mode=!1,this.power_node.stopAllActions(),this.power_node.runAction(cc.scaleTo(.5,.4,.4)),this.jump_complete=!1,this.player_jump(),t.play("jump2"))}.bind(this),this),this.bg_node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){this.jump_complete&&(this.is_power_mode=!1,this.power_node.stopAllActions(),this.power_node.runAction(cc.scaleTo(.5,.4,.4)),this.jump_complete=!1,this.player_jump(),t.play("jump2"))}.bind(this),this)},update:function(t){this.is_power_mode&&(this.speed+=this.a_power*t,this.x_distance+=this.speed*t)}}),cc._RF.pop()},{game_scene:"game_scene"}]},{},["block","game_scene","player","player2"]);